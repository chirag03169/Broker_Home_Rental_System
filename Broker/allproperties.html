<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Broker – All Properties</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { background: #fff9f3; }
    .broker-navbar { background: orange; border-radius: 0 0 14px 14px; }
    .search-row {
      margin: 40px auto 18px auto;
      max-width: 660px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
    }
    .search-row input {
      border-radius: 10px;
      border: 1.5px solid #ffb463;
      outline: none;
      font-size: 1.09rem;
      padding: 10px 20px;
      min-width: 170px;
      background: #fff;
    }
    .search-row button {
      border-radius: 10px;
      font-weight: 700;
      background: orange;
      color: #fff;
      border: none;
      padding: 10px 28px;
      font-size: 1rem;
      letter-spacing: 0.7px;
      transition: background 0.2s;
    }
    .search-row button:hover { background: #ff9900; }
    .property-listing {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(255,140,0,.10);
      margin-bottom: 28px;
      display: flex;
      align-items: stretch;
      overflow: hidden;
      transition: box-shadow .24s;
    }
    .property-listing:hover { box-shadow: 0 8px 30px rgba(255,140,0,.18); }
    .prop-img-box {
      width: 240px; min-width: 160px; background: #eaeaea; overflow: hidden; display: flex; align-items: center;
    }
    .prop-img-box img {
      width: 100%; height: 100%; object-fit: cover;
    }
    .prop-details {
      flex: 1;
      padding: 26px 30px 18px 34px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .prop-title { font-size: 1.4rem; font-weight: 700; color: #2d1818; }
    .prop-info-row { margin-bottom: 9px; color: #555; font-size: 1.09rem; }
    .prop-price { font-size: 1.17rem; font-weight: 800; color: #0b6e4f; margin-right: 1.2em;}
    .prop-info { margin-right: 1.2em;}
    .prop-highlights { margin: 8px 0 12px 0; display: flex; gap: 12px; flex-wrap: wrap; }
    .highlight-badge { background: #ffe8c6; color: #df6405; font-size: 1em; padding: 3px 10px; border-radius: 12px; font-weight: 600; }
    .action-row { margin-top: 14px; display: flex; gap: 12px; }
    .btn-prop {
      background: orange; color: #fff; border-radius: 13px; font-weight: 700; border: none;
      padding: 7px 22px; font-size: 1rem; transition: background 0.23s;
    }
    .btn-prop:hover { background: #ff9900; }
    .btn-danger { background: #d22323 !important;}
    .btn-danger:hover { background: #a61212 !important;}
    @media (max-width: 900px) {
      .property-listing { flex-direction: column; }
      .prop-img-box { width: 100%; height: 170px; }
      .prop-details { padding: 20px 15px 10px 15px; }
      .search-row { flex-direction: column; gap: 10px; }
    }
    .footer { background: #ff7f27; color: #fff; font-weight: 600; font-size: 1.1rem; padding: 1.3rem 1rem 1.1rem; border-top: 1.5px solid #ffe6cc; text-align: center; flex-shrink: 0;}
    .footer h5 { font-weight: 700; margin-bottom: 0.35em;}
    .footer p { margin-bottom: 0; font-weight: 400;}
    .no-properties { text-align: center; color: #d0450a; font-size: 1.17rem; margin: 40px 0;}
    .contact-info {
      margin-top: 12px;
      font-size: 1.05rem;
      color: #0b6e4f;
      font-weight: 700;
      background: #e2f5e9;
      padding: 8px 14px;
      border-radius: 18px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      width: fit-content;
      box-shadow: 0 2px 6px rgba(11, 110, 79, 0.3);
    }
    .contact-icon {
      width: 22px;
      height: 22px;
      fill: #0b6e4f;
    }
    .postal-code {
      font-weight: 600;
      font-size: 1.03rem;
      color: #5a4b22;
      border-radius: 10px;
      padding: 0.3em 0.7em;
      background: #fff2cc;
      margin-left: 8px;
      box-shadow: inset 0 0 3px #c09e40;
    }
    .state-indicator {
      display: inline-block;
      font-size: 1.13em;
      font-weight: 700;
      color: #fff;
      background: orange;
      padding: 4px 16px;
      border-radius: 14px;
      margin-bottom: 16px;
      margin-left: 6px;
      margin-top: 4px;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px rgba(255,140,0,0.12);
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg broker-navbar shadow-sm">
    <div class="container">
      <a class="navbar-brand text-white fw-bold" href="home.html">Broker</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link text-white" href="gethome.html">All States</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="home.html">Home</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="#">About Us</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="#contact">Contact</a></li>
          <li class="nav-item"><a class="nav-link text-white" href="login.html">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <header class="container my-4 text-center">
    <h2 style="color: orange; font-weight: bold;">All Properties – Across States</h2>
    <div id="stateIndicator"></div>
    <p>See all flats and houses listed by owners nationwide. Filter by city or postal code as needed.</p>
  </header>

  <section class="search-row">
    <input id="citySearch" type="text" placeholder="City Name " oninput="filterProps()" />
    <input id="postalSearch" type="text" placeholder="Postal Code" oninput="filterProps()" />
    <button onclick="clearFilters()">Clear</button>
  </section>

  <section class="container" id="propertyContainer"></section>

  <footer class="footer mt-auto">
    <h5>Rental homes listed nationwide</h5>
    <p>Find your next home with Broker!</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Get query param
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    // State from URL
    let selectedState = getQueryParam('state');

    function createCard(property, index) {
      let highlights = '';
      if (property.description) {
        let possible = property.description.split(/[,;.]+/);
        highlights = possible
          .map(f => f.trim())
          .filter(f => f.length && f.toLowerCase() !== 'furnished' && !/^\d+/.test(f))
          .map(f => `<span class="highlight-badge">${f}</span>`).join('');
      }
      return `
      <div class="property-listing" data-city="${property.city.toLowerCase()}" data-postal="${property.postal}" data-desc="${property.description.toLowerCase()}" data-index="${index}">
        <div class="prop-img-box">
          <img src="${property.image}" alt="Flat property image" />
        </div>
        <div class="prop-details">
          <div>
            <span class="prop-title">${property.address}, ${property.city}, ${property.state}</span>
            <span class="postal-code">${property.postal}</span>
            <div class="prop-info-row">
              <span class="prop-price">₹${property.price}/mo</span>
              <span class="prop-info">${property.description}</span>
            </div>
            <div class="prop-highlights">${highlights}</div>
          </div>
          <div class="action-row">
            <button class="btn-prop">Contact</button>
            <button class="btn-prop">View Number</button>
            <button class="btn-prop btn-danger" onclick="deleteProperty(${index})">Delete</button>
          </div>
          <div class="contact-info" title="Owner Contact Information">
            <svg class="contact-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path d="M391 351c-21.5 0-41.9-5.4-60-15.3-2.2-1.2-5.1-1.4-7.6-.5-19.6 8.4-42.8 8.4-62.4 0-2.6-.9-5.6-.7-7.9.7-17.4 10-37.7 15.8-59.3 15.8-7.3 0-13.2-5.5-15-12.9-8.2-34-12.2-69.8-12.2-106 0-114.9 93.1-208 208-208 114.9 0 208 93.1 208 208 0 114.7-93.1 207.8-208 207.8zm120-77.2-39.2-34.6c-7-6.1-18.6-5.7-34.1.3-26.2 10.3-51.8 10.3-77.6 0-7.7-3-13-6.2-24-20.9l-54.1-75.5c-2-2.6-2-5.7 0-8.3l27.5-36.7c2-2.6 5.7-3.2 8.5-1.2 10.8 7.8 26.8 25.6 50.5 54.6 15.1 17 29.5 25.2 43.3 25.2 9.9 0 19.5-7.3 29.4-21.5 18.8-23.8 25.5-32 28-35.2 2.1-2.6 6-3.4 8.7-.9l39 36c2.1 1.9 2.7 4.7 1.5 7.3-1.6 3.4-9.9 22.6-43.7 54.2z"/>
            </svg>
            <span>${property.name} - ${property.phone}</span>
          </div>
        </div>
      </div>
      `;
    }

    function loadProperties() {
      const container = document.getElementById('propertyContainer');
      let properties = [];
      try {
        const stored = localStorage.getItem('all_properties');
        if (stored) properties = JSON.parse(stored);
      } catch(e){}
      // If selectedState exists, filter properties for that state and show indicator
      if (selectedState) {
        properties = properties.filter(
          p => (p.state || '').toLowerCase() === selectedState.toLowerCase()
        );
        // Show filter indicator above list
        document.getElementById('stateIndicator').innerHTML =
          `<span class="state-indicator">Showing only: ${selectedState}</span>`;
      } else {
        document.getElementById('stateIndicator').innerHTML = "";
      }
      if (properties.length === 0) {
        container.innerHTML = '<div class="no-properties">No properties found. List your property to see it here!</div>';
        return;
      }
      container.innerHTML = properties.map((p, i) => createCard(p, i)).reverse().join('');
    }

    function filterProps() {
      const city = document.getElementById('citySearch').value.trim().toLowerCase();
      const postal = document.getElementById('postalSearch').value.trim();
      document.querySelectorAll('.property-listing').forEach(listing => {
        const cityData = listing.getAttribute('data-city') || '';
        const postalData = listing.getAttribute('data-postal') || '';
        const desc = listing.getAttribute('data-desc') || '';
        let show = true;
        if(city && !(cityData.includes(city) || desc.includes(city))) show = false;
        if(postal && !postalData.includes(postal)) show = false;
        listing.style.display = show ? '' : 'none';
      });
    }

    function clearFilters() {
      document.getElementById('citySearch').value = '';
      document.getElementById('postalSearch').value = '';
      filterProps();
    }

    function deleteProperty(index) {
      if (!confirm("Are you sure you want to delete this property?")) return;
      let properties = [];
      try {
        const stored = localStorage.getItem('all_properties');
        if (stored) properties = JSON.parse(stored);
      } catch(e){}
      properties.splice(index, 1);
      localStorage.setItem('all_properties', JSON.stringify(properties));
      loadProperties();
      filterProps();
    }

    window.onload = loadProperties;
  </script>
</body>
</html>
